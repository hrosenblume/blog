generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Post {
  id             String     @id @default(uuid())
  title          String
  slug           String     @unique
  markdown       String
  status         String     @default("draft")
  polyhedraShape String?
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  publishedAt    DateTime?
  subtitle       String?
  revisions      Revision[]
  
  // SEO fields (optional overrides)
  seoTitle       String?
  seoDescription String?
  seoKeywords    String?
  noIndex        Boolean    @default(false)
  ogImage        String?    // Custom Open Graph image URL
}

model Revision {
  id             String   @id @default(uuid())
  postId         String
  title          String?
  subtitle       String?
  markdown       String
  polyhedraShape String?
  createdAt      DateTime @default(now())
  post           Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  
  // SEO fields
  seoTitle       String?
  seoDescription String?
  seoKeywords    String?
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String?
  role      String   @default("writer")
  createdAt DateTime @default(now())
}

model Lead {
  id         String      @id @default(uuid())
  email      String?     @unique
  firstName  String?
  lastName   String?
  linkedIn   String?
  title      String?
  company    String?
  companyUrl String?
  industry   String?
  employees  String?
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  visits     LeadVisit[]

  @@index([company])
  @@index([linkedIn])
}

model LeadVisit {
  id         String   @id @default(uuid())
  leadId     String
  lead       Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  userAgent  String?
  pageUrl    String?
  referrer   String?
  rawPayload String?
  visitedAt  DateTime @default(now())

  @@index([leadId])
  @@index([visitedAt])
}

model AISettings {
  id               String   @id @default("default")
  rules            String   @default("")
  chatRules        String   @default("")
  defaultModel     String   @default("claude-sonnet")
  anthropicApiKey  String?
  openaiApiKey     String?
  generateTemplate String?  // Custom generate prompt template
  chatTemplate     String?  // Custom chat prompt template
  rewriteRules     String?  // Specific rules for magic pencil rewrites
  rewriteTemplate  String?  // Custom rewrite prompt template
  updatedAt        DateTime @updatedAt
}

model SiteSettings {
  id                String   @id @default("default")
  siteTitle         String   @default("")
  siteTitleTemplate String   @default("%s | {name}")
  siteDescription   String   @default("")
  siteKeywords      String   @default("")
  twitterHandle     String   @default("")
  orgName           String   @default("")
  orgLogo           String   @default("")
  orgSameAs         String   @default("[]")
  defaultOgImage    String   @default("")  // Fallback OG image for all pages
  updatedAt         DateTime @updatedAt
}

model PageSettings {
  id          String   @id           // e.g., "home", "essays"
  path        String   @unique       // e.g., "/", "/essays"
  title       String?                // Custom page title
  description String?                // Custom meta description
  keywords    String?                // Comma-separated keywords
  noIndex     Boolean  @default(false)
  ogImage     String?                // Custom Open Graph image URL
  updatedAt   DateTime @updatedAt
}

model IntegrationSettings {
  id                  String   @id @default("default")
  googleAnalyticsId   String?  // GA4 measurement ID (G-XXXXXXXXXX)
  rb2bApiKey          String?  // RB2B tracking key
  contactEmail        String?  // Public contact email
  anthropicApiKey     String?  // Anthropic API key for Claude models
  openaiApiKey        String?  // OpenAI API key for GPT models
  updatedAt           DateTime @updatedAt
}
